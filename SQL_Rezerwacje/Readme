# ğŸ—„ï¸ System Rezerwacji Wycieczek â€“ Projekt Bazy Danych

Kompleksowy system rezerwacji wycieczek z wykorzystaniem **SQL** i **procedur skÅ‚adowanych**, ktÃ³ry obsÅ‚uguje klientÃ³w indywidualnych oraz firmowych, rezerwacje wycieczek, dodatkowych usÅ‚ug i atrakcji, pÅ‚atnoÅ›ci oraz zarzÄ…dzanie pracownikami. Projekt powstaÅ‚ w ramach kursu **Bazy Danych** na AGH.

---

## ğŸ“‚ Struktura projektu

```
SQL_Reservation_System/
â”œâ”€â”€ schema.sql               # Definicje tabel i relacji (DDL)
â”œâ”€â”€ views.sql                # Definicje widokÃ³w (raporty, statystyki)
â”œâ”€â”€ procedures.sql           # Procedury skÅ‚adowane
â”œâ”€â”€ triggers.sql             # Triggery do automatyzacji logiki biznesowej
â”œâ”€â”€ test_data.sql            # Wstawianie przykÅ‚adowych danych
â””â”€â”€ README.md                # Instrukcja i opis projektu
```

---

## ğŸ“ Opis kluczowych komponentÃ³w

### 1. `schema.sql`
- Tworzy **29 tabel** z relacjami (PK, FK, UNIQUE, CHECK):
  - Kluczowe encje: `Clients`, `Companies`, `Employees`, `Tours`, `Orders`, `Payments`, `Services`, `Attractions`
  - Tabele Å‚Ä…cznikowe: `Order_Participants`, `Order_Attractions`, `Order_Services`, `Employees_Tours` itd.
  - Warunki integralnoÅ›ci: poprawnoÅ›Ä‡ emaili, numerÃ³w telefonÃ³w, adresÃ³w, NIP/REGON

### 2. `views.sql`
- Widoki umoÅ¼liwiajÄ…ce raportowanie i analizÄ™ danych:
  - **OrderFinalPrice** â€“ oblicza ostatecznÄ… cenÄ™ zamÃ³wienia
  - **Top3Tours** â€“ najczÄ™Å›ciej wybierane wycieczki
  - **Pending_Payments** â€“ zamÃ³wienia oczekujÄ…ce pÅ‚atnoÅ›ci
  - **Available_Tour_Spots** â€“ dostÄ™pnoÅ›Ä‡ miejsc na wycieczkach
  - **Client_Order_History** â€“ historia zamÃ³wieÅ„ klientÃ³w

### 3. `procedures.sql`
- Procedury automatyzujÄ…ce operacje na danych:
  - **AddParticipantToOrder** â€“ dodanie uczestnika do zamÃ³wienia
  - **CheckAndUpdateOrderStatus** â€“ aktualizacja statusu zamÃ³wienia po wpÅ‚acie
  - **CheckAndCancelUnpaidOrders** â€“ anulowanie nieopÅ‚aconych zamÃ³wieÅ„ na tydzieÅ„ przed wycieczkÄ…

### 4. `triggers.sql`
- Triggery zapewniajÄ…ce automatyzacjÄ™ logiki biznesowej:
  - Ustawianie daty pÅ‚atnoÅ›ci po zmianie statusu zamÃ³wienia
  - Dodanie uczestnika do wycieczki po nowym zamÃ³wieniu
  - Weryfikacja unikalnoÅ›ci emaili przed aktualizacjÄ… klientÃ³w
  - Automatyczne przypisanie przeÅ‚oÅ¼onego dla nowych pracownikÃ³w

### 5. `test_data.sql`
- Wstawia dane testowe dla:
  - KlientÃ³w, firm, pracownikÃ³w
  - Wycieczek, atrakcji, usÅ‚ug
  - ZamÃ³wieÅ„, pÅ‚atnoÅ›ci, uczestnikÃ³w

---

## âš™ï¸ Wymagania techniczne

- **SQL Server** lub dowolna baza wspierajÄ…ca T-SQL (np. Azure SQL)
- Zalecane IDE: **SQL Server Management Studio (SSMS)** lub **Azure Data Studio**

---

## ğŸš€ Instrukcja uruchomienia

1. UtwÃ³rz nowÄ… bazÄ™ danych (np. `ReservationSystem`).
2. Wykonaj plik `schema.sql` w celu utworzenia struktury tabel.
3. Wstaw widoki (`views.sql`), procedury (`procedures.sql`) i triggery (`triggers.sql`).
4. Dodaj dane testowe uruchamiajÄ…c `test_data.sql`.
5. MoÅ¼esz teraz wykonywaÄ‡ zapytania lub testowaÄ‡ dziaÅ‚anie systemu:
   ```sql
   SELECT * FROM Available_Tour_Spots;
   EXEC AddParticipantToOrder @OrderID = 1, @ClientID = 2;
   ```

---

## ğŸ“Š PrzykÅ‚adowe zapytania

- Sprawdzenie dostÄ™pnych miejsc na wycieczkach:
  ```sql
  SELECT * FROM Available_Tour_Spots;
  ```

- Wygenerowanie raportu cen za zamÃ³wienia:
  ```sql
  SELECT * FROM OrderFinalPrice;
  ```

- Historia zamÃ³wieÅ„ klientÃ³w:
  ```sql
  SELECT * FROM Client_Order_History;
  ```

---

## ğŸ‘¨â€ğŸ’» Autorzy

- **Mieszko Makowski**
- **Karol MierzwiÅ„ski**
- **Mateusz Wirkijowski**
- **Patryk Motylski**

Projekt na potrzeby kursu **Bazy Danych**, AGH, 2025.

